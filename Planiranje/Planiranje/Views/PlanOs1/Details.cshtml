@model Planiranje.Models.PlanOs1View
@using Planiranje.Models
@{ Layout = Request.IsAjaxRequest() ? null : "~/Views/Shared/_Layout.cshtml";}

<div class="inner">
	@*<script>
         $(document).ready(function () {
             if ($("#poruka").text() == "1") {
                 showSnackBar('@TempData["note"]');
             }
         })
	</script>*@

	@if (TempData["note"] != null)
	{
		<div id="poruka" style="display:none">1</div>
	}
	@*@if (TempData["prikaz"] != null)
	{
		<div id="prikaz" style="display:none">1</div>
	}
	@if (Model.OsPlan1Podrucje.Count == 0)
	{
		<div id="provjerapodrucja" style="display:none">1</div>
	}*@
	<div class="row">
		<div class="col-lg-12">

		</div>
	</div>
	<div class="row">
		<div class="col-lg-12">
			<div class="panel panel-default">
				<div class="panel-heading">
					<div class="row">
						<div class="col-lg-10">
							<h4> Kreiranje plana i programa</h4>
							<h5> Naziv plana i programa: @Model.OsPlan1.Naziv </h5>
							<p>
								<a onclick="reloadPage('@Url.Action("Index", "PlanOs1")')" class="btn btn-success btn-xs btn-grad"> Povratak na popis</a>
							</p>
						</div><!--END COL 10-->
						<div class="col-lg-2">
							<a href="@Url.Action("IspisDetalji","PlanOs1",new { id=Model.OsPlan1.Id_plan})" target="_blank" class="btn btn-success btn-sm">ISPIS / PDF DOKUMENT</a>
						</div>
					</div><!--END ROW -->
				</div>
				<div class="panel-body">
					<div class="row">
						<div class="col-lg-12">
							<div class="panel-body">

								<ul class="nav nav-pills">
									<li class="active">
										<a href="#podrucje" data-toggle="tab">Područja rada</a>
									</li>
									<li>
										<a id="btnAktivnostTab" href="#aktivnosti" data-toggle="tab">Programske aktivnosti</a>
									</li>
									<li>
										<a href="#vrijeme" data-toggle="tab">Vrijeme realizacije</a>
									</li>
								</ul>

								<div class="tab-content">
									<div class="tab-pane fade in active" id="podrucje">
										<div class="row">
											<div class="col-lg-12">
												<p>
													<button class="btn btn-primary btn-xs btn-grad" onclick="showModal('@Url.Action("NovoPodrucje", "PlanOs1", new { id = Model.OsPlan1.Id_plan })')">
														Dodaj područje djelovanja
													</button>
												</p>
												<div class="table-responsive">
													<table class="table table-striped table-bordered table-hover" id="dataTablePodrucje">
														<thead>
															<tr>
																<th>Rb.</th>
																<th>Područje rada</th>
																<th>Potrebno<br>sati</th>
																<th>Cilj</th>
																<th>Pomak</th>
																<th>Aktivnost</th>
															</tr>
														</thead>
														<tbody>
															@{int brojac = 1;}
															@foreach (var item in Model.OsPlan1Podrucje)
															{
																var podrucje = new Podrucje_rada();
																podrucje = Model.PodrucjeRada.Single(s => s.Id_podrucje == item.Opis_Podrucje);																

																<tr>
																	<td class="col-md-1">@brojac</td>
																	<td class="col-md-4">@podrucje.Naziv</td>
																	<td class="col-md-2">@item.Potrebno_sati</td>
																	<td class="col-md-3" style="white-space:pre-line">@item.Cilj</td>
																	<td class="col-md-1">
																		<a onclick="reloadPage('@Url.Action("PodrucjePomakGore", "PlanOs1", new { id = item.Id_plan })')" class="btn btn-warning btn-xs btn-grad">Gore</a>
																		<a onclick="reloadPage('@Url.Action("PodrucjePomakDolje", "PlanOs1", new { id = item.Id_plan })')" class="btn btn-warning btn-xs btn-grad">Dolje</a>
																	</td>
																	<td class="col-md-1">
																		<a onclick="showModal('@Url.Action("UrediPodrucje", "PlanOs1", new { id = item.Id_plan })')" class="btn btn-primary btn-xs btn-grad">Uredi</a>
																		<a onclick="showModal('@Url.Action("ObrisiPodrucje", "PlanOs1", new { id = item.Id_plan, pozicija=brojac })')" class="btn btn-danger btn-xs btn-grad">Obriši</a>
																	</td>
																</tr>
																brojac++;

															}
														</tbody>
													</table>
												</div>
											</div><!--END COL 12-->
										</div>
									</div>
									<div class="tab-pane fade" id="aktivnosti">
										
									</div>
									<div class="tab-pane fade" id="vrijeme">
										
									</div>
								</div>
							</div><!--END nav-pills -->

						</div><!--END BODY -->
					</div><!--END col 12 -->
				</div> <!--END row -->
			</div>
		</div>

	</div>
	@*<div style="display:none" id="pozicija">@Model.OsPlan1.Id_plan</div>*@
</div>
@*<script>
	function PromjenaPodrucje() {
		var val = $("#selectPodrucje").val();
		var poz = $("#pozicija").text();
		$.ajax({
			url: '/PlanOs1/Details2/' + poz + '?pozicija=' + val,
			success: function (data) {
				$("#content").html(data);
			}
		});
	}
</script>

<script>
	$(document).ready(function () {
        $('#dataTables-example').dataTable();
        $('#dataTable').dataTable();
	});
</script>
<script>
	$(document).ready(function () {
		if ($("#provjerapodrucja").text() == "1") {
			$("#btnAktivnost").prop("disabled", true);
		}
	});
</script>
<script>
	$(document).ready(function () {
		if ($("#prikaz").text() == "1") {
			$("#btnAktivnostTab").click();
		}
	});
</script>*@
<script>
    $(document).ready(function () {
        //var tip = $("#tip").text();
        //var skola = $("#selectSkola").val();
        //var akt = $("#selectAktivnost").val();
        //var saved1 = window.sessionStorage.getItem(skola + tip + "_select");
        //if (saved1 != null && saved1 != akt) {
        //    reloadPage(saved1 + "/Index");
        //}
        //else if (window.sessionStorage.getItem(skola + tip + "_godina") != null) {
        //    var saved = window.sessionStorage.getItem(skola + tip + "_godina");
        //    $("#selectGodina").val(saved);
        //    promjenaGodine();
        //}
        $('#dataTablePodrucje').dataTable({ stateSave: true });
        if ($("#poruka").text() == "1") {
            showSnackBar("@TempData["note"]");
        }
    });
    function provjeriEnter(event, path, form, target, poruka) {
        if (event.type === "keydown") {
            if (event.keyCode === 13) {
                event.preventDefault();
                zatvoriModal(path, form, target, poruka);
            }
        }
    }
    function ispis() {
        var tip = $("#tip").text();
        var skola = $("#selectSkola").val();
        var akt = $("#selectAktivnost").val();
        var god = $("#selectGodina").val();
        if (god > 0) {
            var id = window.sessionStorage.getItem(skola + tip + "_idUcenik");
            if (id != null) {
                window.open(akt + "/Ispis?godina=" + god + "&id=" + id);
            }
            else {
                showSnackBar("Odaberite učenika");
            }
        }
        else {
            showSnackBar("Odaberite godinu");
        }
    }
    function promjenaGodine() {
        var tip = $("#tip").text();
        var skola = $("#selectSkola").val();
        var val = $("#selectGodina").val();
        if (val != "0") {
            $.ajax({
                url: '/PracenjeUcenika/OdabirRazreda?godina=' + val,
                success: function (data) {
                    $("#razredi").html(data);
                    var akt = $("#selectAktivnost").val();
                    var saved = window.sessionStorage.getItem(skola + tip + "_godina");
                    if (saved != null && saved == $("#selectGodina").val()) {
                        var saved1 = window.sessionStorage.getItem(skola + tip + "_razred");
                        if (saved1 != null) {
                            $("#selectRazred").val(saved1);
                            promjenaRazreda();
                        }
                    }
                },
                error: function (request, status, error) {
                    showSnackBar("Dogodila se greška prilikom obrađivanja Vašeg zahtjeva");
                }
            });
        }
        else {
            $("#razredi").empty();
        }
        $("#tablica").empty();
        $("#detalji").empty();
    }
    function promjenaRazreda() {
        var tip = $("#tip").text();
        var skola = $("#selectSkola").val();
        var val = $("#selectRazred").val();
        var god = $("#selectGodina").val();
        var akt = $("#selectAktivnost").val();

        if (val != "0") {
            $.ajax({
                url: '/PracenjeUcenika/OdabirUcenika?razred=' + val + '&godina=' + god,
                success: function (data) {
                    $("#tablica").html(data);
                    $("#dataTableUcenici").dataTable({ stateSave: true });
                    var saved = window.sessionStorage.getItem(skola + tip + "_godina");
                    var saved1 = window.sessionStorage.getItem(skola + tip + "_razred");
                    var id = window.sessionStorage.getItem(skola + tip + "_idUcenik");
                    if (saved != null && saved1 != null) {
                        if (saved == god && saved1 == val && id != null) {
                            pokaziDetalje(id);
                        }
                    }
                },
                error: function (request, status, error) {
                    showSnackBar("Dogodila se greška prilikom obrađivanja Vašeg zahtjeva");
                }
            });
        }

        else {
            $("#tablica").empty();
            $("#detalji").empty();
        }
    }
    function pokaziDetalje(id) {
        var tip = $("#tip").text();
        var skola = $("#selectSkola").val();
        var val = $("#selectGodina").val();
        var akt = $("#selectAktivnost").val();
        var raz = $("#selectRazred").val();
        window.sessionStorage.setItem(skola + tip + "_idUcenik", id);
        $.ajax({
            url: akt + '/Detalji?id=' + id + '&godina=' + val,
            success: function (data) {
                $("#detalji").html(data);
            },
            error: function (request, status, error) {
                showSnackBar("Dogodila se greška prilikom obrađivanja Vašeg zahtjeva");
            }
        });
        window.sessionStorage.setItem(skola + tip + "_godina", val);
        window.sessionStorage.setItem(skola + tip + "_razred", raz);
    }
    function potvrdi(path, id, poruka) {
        var dt = $(id).serialize();
        $.ajax({
            url: path,
            type: "POST",
            data: dt,
            success: function (data) {
                showSnackBar(poruka);
            },
            error: function (request, status, error) {
                showSnackBar("Dogodila se greška prilikom obrađivanja Vašeg zahtjeva");
            }
        });
    }
    function odustani(path, id) {
        $.ajax({
            url: path,
            success: function (data) {
                $(id).html(data);
            },
            error: function (request, status, error) {
                showSnackBar("Dogodila se greška prilikom obrađivanja Vašeg zahtjeva");
            }
        });
    }
    function zatvoriModal(path, id, spremi, poruka) {
        var dt = $(id).serialize();
        $.ajax({
            url: path,
            type: "POST",
            data: dt,
            success: function (data) {
                if ($(data)[0].tagName === "P") {
                    $(spremi).html(data);
                    $('#modal').modal('hide');
                    $('#modalContainer').removeData();
                    $('.modal-backdrop').remove();
                    showSnackBar(poruka);
                }
                else if ($(data)[0].tagName === "DIV") {
                    $("#modalContainer").html(data);
                }
                else {
                    location.reload();
                }
            },
            error: function (request, status, error) {
                showSnackBar("Dogodila se greška prilikom obrađivanja Vašeg zahtjeva");
            }
        });
    }
    function promjenaAktivnost() {
        var tip = $("#tip").text();
        var skola = $("#selectSkola").val();
        var val = $("#selectAktivnost").val();
        if (val == "/PopisUcenika" || $("#selectGodina").val() == "0" || !$("#selectRazred").length || $("#selectRazred").val() == "0") {
            window.sessionStorage.setItem(skola + tip + "_select", val);
            reloadPage(val + "/Index");
        }
        else if (/*$("#selectRazred").length==0 &&*/ $("#selectRazred").val() != "0") {
            var id = window.sessionStorage.getItem(skola + tip + "_idUcenik");
            window.sessionStorage.setItem(skola + tip + "_select", val);
            pokaziDetalje(id);
        }
        else {
            window.sessionStorage.setItem(skola + tip + "_select", val);
            val = val + "/Index";
            reloadPage(val);
        }
    }
</script>




